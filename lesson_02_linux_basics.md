# Урок 2 — Linux: файловая система и базовые команды

## Зачем это нужно

Все серверы в мире работают на Linux. Не Windows, не macOS — Linux. Умение уверенно работать в терминале — это базовый навык без которого дальше не двинуться. Графический интерфейс на сервере обычно нет. Только терминал. Если ты не можешь в нём работать — ты не можешь работать с сервером.

---

## Часть 1 — Файловая система Linux

### Всё есть файл

В Linux всё является файлом. Текстовый документ — файл. Программа — файл. Жёсткий диск — файл. Сетевое соединение — файл. Это не метафора, это архитектурное решение которое делает Linux очень мощным.

### Структура директорий

В отличие от Windows (где есть диски C:, D:) в Linux одно дерево директорий с корнем `/`:

```
/                   # Корень. Всё начинается отсюда.
├── bin/            # Основные программы (ls, cp, mv...)
├── etc/            # Конфигурационные файлы
├── home/           # Домашние папки пользователей
│   └── username/   # Твоя домашняя папка (~)
├── var/            # Переменные данные (логи, базы данных...)
├── tmp/            # Временные файлы (удаляются при перезагрузке)
├── usr/            # Установленные программы и библиотеки
├── proc/           # Виртуальная ФС: информация о процессах
├── dev/            # Устройства (диски, терминалы...)
└── root/           # Домашняя папка суперпользователя root
```

Важно знать:
- `~` — сокращение для твоей домашней папки (`/home/username`)
- `.` — текущая директория
- `..` — родительская директория
- Пути бывают **абсолютные** (`/home/user/file.txt`) и **относительные** (`../file.txt`)

### Типы файлов

```
-  обычный файл
d  директория
l  символическая ссылка (ярлык)
b  блочное устройство (диск)
c  символьное устройство
```

---

## Часть 2 — Базовые команды

### Навигация

```bash
pwd                  # Где я сейчас нахожусь (Print Working Directory)
ls                   # Список файлов в текущей папке
ls -la               # Список со скрытыми файлами и правами доступа
ls -lh               # Список с читаемыми размерами файлов (KB, MB...)
cd /home             # Перейти в /home
cd ~                 # Перейти домой
cd ..                # Перейти на уровень выше
cd -                 # Вернуться в предыдущую директорию
```

### Работа с файлами и папками

```bash
touch file.txt           # Создать пустой файл
mkdir my_folder          # Создать папку
mkdir -p a/b/c           # Создать вложенные папки сразу

cp file.txt copy.txt     # Скопировать файл
cp -r folder/ backup/    # Скопировать папку рекурсивно

mv file.txt new_name.txt # Переименовать файл
mv file.txt /tmp/        # Переместить файл

rm file.txt              # Удалить файл
rm -rf folder/           # Удалить папку со всем содержимым (ОСТОРОЖНО!)

ln -s /path/to/file link # Создать символическую ссылку
```

> ⚠️ **Важно:** В Linux нет корзины в терминале. `rm` удаляет навсегда. `rm -rf /` — уничтожит всю систему. Всегда думай перед удалением.

### Просмотр содержимого файлов

```bash
cat file.txt             # Вывести весь файл
less file.txt            # Постраничный просмотр (q — выход)
head -n 20 file.txt      # Первые 20 строк
tail -n 20 file.txt      # Последние 20 строк
tail -f /var/log/syslog  # Следить за файлом в реальном времени (логи!)
```

### Поиск

```bash
find / -name "file.txt"          # Найти файл по имени
find /home -type f -name "*.log" # Найти все .log файлы
find . -size +10M                # Найти файлы больше 10MB

grep "error" file.txt            # Найти строки содержащие "error"
grep -r "TODO" ./src/            # Искать рекурсивно в папке
grep -i "error" file.txt         # Без учёта регистра
grep -n "error" file.txt         # С номерами строк
```

### Права доступа

Каждый файл в Linux имеет права доступа. Смотрим через `ls -la`:

```
-rwxr-xr-- 1 user group 1234 Jan 1 12:00 script.sh
```

Разбор:
```
-          тип файла (- обычный, d директория, l ссылка)
rwx        права владельца (read, write, execute)
r-x        права группы (read, execute)
r--        права остальных (только read)
```

Числовая запись прав:
```
r = 4
w = 2
x = 1

rwx = 4+2+1 = 7
r-x = 4+0+1 = 5
r-- = 4+0+0 = 4

chmod 755 script.sh   # rwxr-xr-x
chmod 644 file.txt    # rw-r--r--
chmod +x script.sh    # Добавить право на выполнение
```

Смена владельца:
```bash
chown user:group file.txt        # Сменить владельца и группу
sudo chown root:root /etc/hosts  # С правами суперпользователя
```

---

## Часть 3 — Текстовый редактор

### Nano — для начала

```bash
nano file.txt        # Открыть файл в nano
```

Управление в nano:
- `Ctrl+O` — сохранить
- `Ctrl+X` — выйти
- `Ctrl+W` — поиск
- `Ctrl+K` — вырезать строку
- `Ctrl+U` — вставить

### Vim — нужно знать минимум

Vim есть на каждом сервере. Рано или поздно попадёшь в него случайно. Минимум который нужно знать:

```bash
vim file.txt         # Открыть файл

# В vim есть режимы:
# NORMAL режим — по умолчанию, для навигации и команд
# INSERT режим — для ввода текста

i                    # Войти в INSERT режим
Esc                  # Вернуться в NORMAL режим
:w                   # Сохранить
:q                   # Выйти
:wq                  # Сохранить и выйти
:q!                  # Выйти без сохранения
```

---

## Часть 4 — Потоки, пайпы и перенаправление

Это одна из самых мощных концепций Linux.

```bash
# Стандартные потоки:
# stdin  (0) — ввод
# stdout (1) — вывод
# stderr (2) — ошибки

# Перенаправление вывода в файл
echo "hello" > file.txt      # Перезаписать файл
echo "world" >> file.txt     # Добавить в конец файла

# Перенаправление ошибок
command 2> errors.txt        # Ошибки в файл
command > out.txt 2>&1       # Всё (и вывод, и ошибки) в файл

# Пайп | — передать вывод одной команды на вход другой
ls -la | grep ".txt"         # Найти .txt файлы в списке
cat file.txt | wc -l         # Посчитать строки в файле
ps aux | grep nginx          # Найти процесс nginx
cat /var/log/syslog | tail -100 | grep "error"  # Цепочка фильтров
```

---

## Часть 5 — Полезные команды

```bash
# Информация о системе
uname -a             # Версия ядра и система
whoami               # Текущий пользователь
id                   # ID пользователя и группы
uptime               # Как долго работает система
date                 # Текущая дата и время

# Процессы
ps aux               # Все запущенные процессы
top                  # Интерактивный мониторинг (q — выход)
htop                 # Улучшенная версия top (sudo apt install htop)
kill 1234            # Убить процесс с PID 1234
kill -9 1234         # Принудительно убить процесс

# Диск и память
df -h                # Свободное место на дисках
du -sh folder/       # Размер папки
free -h              # Использование оперативной памяти

# История команд
history              # Список последних команд
Ctrl+R               # Поиск по истории команд
!!                   # Повторить последнюю команду
sudo !!              # Повторить последнюю команду с sudo
```

### sudo — суперпользователь

```bash
sudo command         # Выполнить команду с правами root
sudo -i              # Стать root (осторожно!)
su username          # Стать другим пользователем
```

> ⚠️ Root может всё. Работать постоянно под root — плохая практика. Используй sudo только когда нужно.

---

## Практические задания

### Задание 2.1 — Навигация по файловой системе

```bash
# Выполни эти команды и запиши что выводит каждая:
pwd
ls /
ls -la /etc | head -20
ls -la ~
```

**Что нужно сделать:** Нарисуй дерево директорий начиная от `/` — минимум 3 уровня вложенности. Объясни зачем нужна каждая из основных директорий (`/etc`, `/var`, `/home`, `/tmp`).

---

### Задание 2.2 — Работа с файлами

Выполни последовательно:

```bash
# 1. Создай структуру папок
mkdir -p ~/projects/lesson2/src
mkdir -p ~/projects/lesson2/logs

# 2. Создай несколько файлов
touch ~/projects/lesson2/src/main.go
touch ~/projects/lesson2/src/helper.go
echo "first log entry" > ~/projects/lesson2/logs/app.log
echo "second log entry" >> ~/projects/lesson2/logs/app.log
echo "error: something went wrong" >> ~/projects/lesson2/logs/app.log

# 3. Посмотри что получилось
ls -la ~/projects/lesson2/
cat ~/projects/lesson2/logs/app.log
```

**Что нужно сделать:** Найди все строки содержащие слово "error" в папке `~/projects/lesson2/` используя `grep`. Скопируй `app.log` в `/tmp/backup.log`. Проверь что копия существует.

---

### Задание 2.3 — Права доступа

```bash
# Создай скрипт
echo '#!/bin/bash
echo "Hello from script!"
date' > ~/projects/lesson2/hello.sh

# Попробуй запустить
./~/projects/lesson2/hello.sh
# Получишь ошибку Permission denied

# Посмотри права
ls -la ~/projects/lesson2/hello.sh

# Дай права на выполнение
chmod +x ~/projects/lesson2/hello.sh

# Теперь запусти
~/projects/lesson2/hello.sh
```

**Что нужно сделать:** Объясни своими словами что означают права `rwxr-xr--`. Кто может читать файл? Кто может запускать? Кто может изменять?

---

### Задание 2.4 — Пайпы и фильтрация

```bash
# Посмотри запущенные процессы и найди среди них bash
ps aux | grep bash

# Посчитай сколько файлов в /etc
ls /etc | wc -l

# Найди 5 самых больших файлов в /var/log
sudo du -sh /var/log/* 2>/dev/null | sort -rh | head -5

# Посмотри последние 20 строк системного лога с фильтрацией
sudo tail -20 /var/log/syslog | grep -i "error\|warning"
```

**Что нужно сделать:** Напиши команду которая: находит все файлы в `/etc` с расширением `.conf`, считает их количество и выводит только это число. Используй `find`, `wc` и пайп.

---

### Задание 2.5 — Финальный проект урока

Создай bash-скрипт `~/projects/lesson2/info.sh` который при запуске выводит:
1. Текущую дату и время
2. Имя пользователя
3. Текущую директорию
4. Свободное место на диске (только цифру для `/`)
5. Количество запущенных процессов

Скрипт должен запускаться командой `./info.sh` из папки `~/projects/lesson2/`.

**Подсказка:** Используй команды `date`, `whoami`, `pwd`, `df`, `ps aux | wc -l` и перенаправление вывода через `echo`.

---

## Шпаргалка — команды которые нужно знать наизусть

| Команда | Что делает |
|---------|-----------|
| `pwd` | Текущая директория |
| `ls -la` | Список файлов с правами |
| `cd path` | Перейти в директорию |
| `cp src dst` | Копировать |
| `mv src dst` | Переместить/переименовать |
| `rm -rf` | Удалить (осторожно!) |
| `cat file` | Вывести файл |
| `grep pattern file` | Найти в файле |
| `find . -name` | Найти файл |
| `chmod 755 file` | Изменить права |
| `sudo command` | Выполнить как root |
| `ps aux` | Список процессов |
| `kill PID` | Убить процесс |

---

## Ресурсы для изучения

- **Интерактивный тренажёр:** `https://linuxjourney.com` — пройди раздел Grasshopper
- **Практика онлайн:** `https://www.learnshell.org` — можно практиковаться прямо в браузере
- **Справка по любой команде:** `man ls`, `man grep`, `man find` — прямо в терминале
- **Русский ресурс:** Хекслет — "Основы командной строки"

---

## Как понять что урок пройден

- [ ] Знаю структуру директорий Linux и зачем каждая папка
- [ ] Могу создавать, копировать, перемещать, удалять файлы и папки
- [ ] Понимаю права доступа и умею их менять через chmod
- [ ] Умею использовать пайпы для фильтрации вывода
- [ ] Написал и запустил финальный скрипт `info.sh`
- [ ] Могу найти любой файл через `find` и `grep`

---

*Следующий урок: Linux — процессы, сеть и переменные окружения*
